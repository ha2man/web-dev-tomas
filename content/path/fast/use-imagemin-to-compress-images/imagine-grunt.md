---
title: Using Imagemin with Grunt
author: khempenius
page_type: glitch
glitch: imagemin-grunt
---

# Use Imagemin with Grunt

This workbook will show you how to add Imagemin to an existing Grunt project.

## 1. Install the Imagemin Grunt plugin

---

We've already installed `grunt` and `grunt-cli` for you, but you'll need to install `grunt-contrib-imagemin`.

☞ Click the "Logs" button.
<img src="./assets/logs_button.png" alt="The 'Logs' button in Glitch">

☞ Then click the "Console" button.
<img src="./assets/console_button.png" alt="The 'Console' button in Glitch">

☞ Type these commands:

```shell
$ enable-npm
$ npm install --save-dev grunt-contrib-imagemin

## 2. Setup the Imagemin Grunt plugin

---

We don't need to create a `gruntfile.js` file because this project already has one.

☞ To add the configuration for Imagemin, first replace the "`//Add configuration here`" comment in `gruntfile.js` with this code block:

```javascript
imagemin: {
    dynamic: {
        files: [{
            cwd: 'images/',
            expand: true,
            src: ['**/*.{png,jpg}'],
        }]
    }
}
```

This code block tells Grunt which files should be compressed with Imagemin.

- `dynamic` indicates that we are not manually specifying a list of files to run Imagemin on. Instead, this list of files will be *dynamically* generated by matching the filenames against the file pattern that we specify.

- The file pattern `{cwd: 'images/', expand: true, src: ['**/*.{png,jpg}']}` will match all the JPG and PNG images in the `'images/'` directory of our project.

(Have more questions about this? You can read more about the Grunt file object <a href="https://gruntjs.com/configuring-tasks#building-the-files-object-dynamically" target="_blank">here</a>.)

☞ Load the Imagemin task by adding this line immediately before `grunt.registerTask(...)`:

```javascript
grunt.loadNpmTasks('grunt-contrib-imagemin');
```

☞ Lastly, add Imagemin the default Grunt task by replacing the `/* list plugins here */` comment with `'imagemin'`. That line should now look like this:

```javascript
grunt.registerTask('default', ['imagemin']);
```

## ✔︎ Check-in

Your complete `gruntfile.js` file should now look like this:

```javascript
const grunt = require('grunt')
grunt.initConfig({
    imagemin: {
        dynamic: {
            files: [{
                cwd: 'images/'
                expand: true,
                src: ['**/*.{png,jpg}'],
            }]
        }
  }
});
grunt.loadNpmTasks('grunt-contrib-imagemin');
grunt.registerTask('default', ['imagemin']);
```

## 4. Customize your Imagemin Configuration

---

We are going to customize our Imagemin configuration to use the `imagemin-pngquant` plugin to compress PNGs. This plugin allows us to specify a compression quality level, which is why we have chosen to use it in this example.

☞ Install the plugin using npm:

```shell
$ npm install --save-dev imagemin-pngquant
```

☞ Declare the `imagemin-pngquant` plugin by adding this line at the top your `gruntfile.js`:

```javascript
const pngquant = require('imagemin-pngquant');
```

☞ Add settings for compressing PNG images by adding an `options` property to the `imagemin` object. That options property should look like this:

```javascript
options: {
  use: [
    pngquant({quality: '50'}),
  ]
},
```

This code tells Grunt to compress PNGs to a quality of '50' ('0' is the worst; '100' is the best) using the Pngquant plugin.

## ✔︎ Check-in

Your `gruntfile.js` file should now look like this:

```javascript
const pngquant = require('imagemin-pngquant');
const grunt = require('grunt')
grunt.initConfig({
    imagemin: {
        options: {
                use: [
                        pngquant({quality: '50'}),
                ]
        },
        dynamic: {
            files: [{
                cwd: 'images/',
                expand: true,
                src: ['**/*.{png,jpg}'],
            }]
        }
  }
});
grunt.loadNpmTasks('grunt-contrib-imagemin');
grunt.registerTask('default', ['imagemin']);
```

But what about JPGs? Our project also has JPG images, so we should specify how they are compressed as well.

## 5. Customize your Imagemin Configuration (continued)

---

<!-- TODO(khempenius): imagemin-mozjpeg currently does not work on Glitch. I believe this can probably be fixed by installing libpng16-dev via apt-get. Ideally, I'd like to use mozjpeg instead of jpegtran, but if this isn't possible this section will need to be changed to use a different plugin. -->

We are going to use the `imagemin-mozjpeg` plugin to compress JPG images.

☞ Install the plugin using npm:

```shell
$ npm install --save-dev imagemin-mozjpeg
```

☞ Declare the `imagemin-mozjpeg` plugin by putting this line at the top your `gruntfile.js`.

```javascript
const mozjpeg = require('imagemin-mozjpeg');
```

☞ Next, add `mozjpeg({quality: '50'})` to the array in the `options` object. That array should now look like this:

```javascript
[
  pngquant({quality: '50'}),
  mozjpeg({quality: '50'})
]
```

## ✔︎ Check-in

Your `gruntfile.js` file should now look like this:

```javascript
const mozjpeg = require('imagemin-mozjpeg');
const pngquant = require('imagemin-pngquant');
const grunt = require('grunt')
grunt.initConfig({
    imagemin: {
        options: {
                use: [
                        pngquant({quality: '50'}),
                        mozjpeg({quality: '50'})
                ]
        },
        dynamic: {
            files: [{
                cwd: 'images/',
                expand: true,
                src: ['**/*.{png,jpg}'],
            }]
        }
  }
});
grunt.loadNpmTasks('grunt-contrib-imagemin');
grunt.registerTask('default', ['imagemin']);
```

## 6. Re-run Grunt & verify results with Lighthouse

---

☞ Re-run Grunt:

```shell
$ grunt
```

When Grunt completes you should see a message like this in terminal:

```shell
Minified 6 images (saved 667 kB - 66.5%)
```

Hooray! These results are much better.

Lastly, it's a good idea to use Lighthouse to verify the changes that you just made. Lighthouse's "Efficiently encode images" performance audit will let you know if the JPG images on your page are optimally compressed.

☞ Click on the "Show Live" button to view the live version of the your Glitch.

<img src="./assets/show-live.png" width="140" alt="The show live button">

☞ Run the Lighthouse performance audit (Lighthouse > Options > Performance) on the live version of your Glitch and verify that the "Efficiently encode images" audit was passed.

<img src="./assets/lighthouse_passing.png" width="100%" alt="Passing 'Efficiently encode images' audit in Lighthouse">

Success! You have used Imagemin to optimally compress the images on your page.